(function(p,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(p=typeof globalThis<"u"?globalThis:p||self,m(p.NodeGraph={}))})(this,(function(p){"use strict";class m{constructor(){this._events=new Map}on(t,e){return this._events.has(t)||this._events.set(t,new Set),this._events.get(t).add(e),()=>this.off(t,e)}off(t,e){this._events.has(t)&&this._events.get(t).delete(e)}emit(t,...e){this._events.has(t)&&this._events.get(t).forEach(s=>{try{s(...e)}catch(i){console.error(`Error in event handler for "${t}":`,i)}})}once(t,e){const s=(...i)=>{this.off(t,s),e(...i)};this.on(t,s)}}function _(d,t){let e;return function(...s){e||(d.apply(this,s),e=!0,setTimeout(()=>e=!1,t))}}function M(d,t){let e;return function(...s){clearTimeout(e),e=setTimeout(()=>d.apply(this,s),t)}}function g(d=""){const t=Date.now().toString(36),e=Math.random().toString(36).substring(2,9);return d?`${d}-${t}-${e}`:`${t}-${e}`}const E={CIRCLE:"circle",SQUARE:"square",ARROW:"arrow",DIAMOND:"diamond",CUSTOM:"custom"},f={HORIZONTAL:"horizontal",VERTICAL:"vertical"};class v{constructor(t){this.id=t.id||g("slot"),this.node=t.node,this.type=t.type,this.label=t.label||"",this.shape=t.shape||E.CIRCLE,this.side=t.side||(t.type==="input"?"left":"right"),this.align=t.align,this.edge=t.edge||!1,t.orientation?this.orientation=t.orientation:this.orientation=this.side==="top"||this.side==="bottom"?f.VERTICAL:f.HORIZONTAL,this.color=t.color||"#667eea",this.size=t.size||12,this.clickAreaSize=t.clickAreaSize||this.size+10,this.highlightOnHover=t.highlightOnHover!==!1,this.customIcon=t.customIcon||null,this.connections=new Set,this._createElement(),this._bindEvents()}_createElement(){this.element=document.createElement("div"),this.element.className=`ng-slot ng-slot--${this.side} ng-slot--${this.orientation}`,this.edge&&this.element.classList.add("ng-slot--edge"),this.element.dataset.slotId=this.id,this.element.dataset.slotType=this.type,this.element.style.setProperty("--ng-slot-size",`${this.size}px`),this.element.style.setProperty("--ng-slot-color",this.color),this.connectorElement=document.createElement("div"),this.connectorElement.className=`ng-slot-connector ng-slot-connector--${this.shape}`,this.clickAreaElement=document.createElement("div"),this.clickAreaElement.className="ng-slot-click-area",this.clickAreaElement.style.width=`${this.clickAreaSize}px`,this.clickAreaElement.style.height=`${this.clickAreaSize}px`,this.label&&(this.labelElement=document.createElement("span"),this.labelElement.className="ng-slot-label",this.labelElement.textContent=this.label),this.shape===E.CUSTOM&&this.customIcon&&(this.connectorElement.innerHTML=this.customIcon),this.connectorElement.appendChild(this.clickAreaElement),this.element.appendChild(this.connectorElement),this.labelElement&&this.element.appendChild(this.labelElement)}_bindEvents(){this.clickAreaElement.addEventListener("mouseenter",()=>{this.highlightOnHover&&this.highlight(!0),this.element.dispatchEvent(new CustomEvent("slot:hover",{bubbles:!0,detail:{slot:this}}))}),this.clickAreaElement.addEventListener("mouseleave",()=>{this.highlightOnHover&&this.highlight(!1),this.element.dispatchEvent(new CustomEvent("slot:hoverend",{bubbles:!0,detail:{slot:this}}))}),this.clickAreaElement.addEventListener("mousedown",t=>{t.button===0&&(t.stopPropagation(),this.element.dispatchEvent(new CustomEvent("slot:dragstart",{bubbles:!0,detail:{slot:this,event:t}})))}),this.clickAreaElement.addEventListener("click",t=>{t.stopPropagation(),this.element.dispatchEvent(new CustomEvent("slot:click",{bubbles:!0,detail:{slot:this,event:t}}))})}getConnectionPoint(){const t=this.connectorElement.getBoundingClientRect(),e=this.node.element.getBoundingClientRect(),s=t.left-e.left+t.width/2,i=t.top-e.top+t.height/2;return{x:this.node.position.x+s,y:this.node.position.y+i}}setColor(t){this.color=t,this.element.style.setProperty("--ng-slot-color",t)}setSize(t){this.size=t,this.element.style.setProperty("--ng-slot-size",`${t}px`)}setLabel(t){this.label=t,this.labelElement&&(this.labelElement.textContent=t)}isConnected(){return this.connections.size>0}getConnectedSlots(){const t=[];return this.connections.forEach(e=>{this.type==="output"?t.push(e.inputSlot):t.push(e.outputSlot)}),t}destroy(){this.connections.forEach(t=>t.destroy()),this.connections.clear(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}serialize(){return{id:this.id,type:this.type,label:this.label,shape:this.shape,orientation:this.orientation,side:this.side,align:this.align,edge:this.edge,color:this.color,size:this.size}}}class S{constructor(t){var e,s;this.id=t.id||g("node"),this.graph=t.graph,this.position={x:((e=t.position)==null?void 0:e.x)||0,y:((s=t.position)==null?void 0:s.y)||0},this.draggable=t.draggable!==!1,this.selected=!1,this.inputSlots=new Map,this.outputSlots=new Map,this.connections=new Set,this._createElement(t),this._createSlots(t.inputs,t.outputs),this._bindEvents(),this._updatePosition()}_createElement(t){this.element=document.createElement("div"),this.element.className="ng-node",t.className&&this.element.classList.add(t.className),this.element.dataset.nodeId=this.id,this.element.style.transform=`translate(${t.position.x}px, ${t.position.y}px)`;const e=document.createElement("div");e.className="ng-node-wrapper",this.element.appendChild(e),this.slotsTop=document.createElement("div"),this.slotsTop.className="ng-node-slots-top",t.slotsTop&&t.slotsTop.style&&Object.assign(this.slotsTop.style,t.slotsTop.style),e.appendChild(this.slotsTop),this.headerElement=document.createElement("div"),this.headerElement.className="ng-node-header",t.header&&t.header.content&&(this.headerElement.innerHTML=t.header.content),t.header&&t.header.className&&this.headerElement.classList.add(t.header.className),t.header&&t.header.style&&Object.assign(this.headerElement.style,t.header.style),e.appendChild(this.headerElement);const s=document.createElement("div");s.className="ng-node-middle",e.appendChild(s),this.slotsLeft=document.createElement("div"),this.slotsLeft.className="ng-node-slots-left",t.slotsLeft&&t.slotsLeft.style&&Object.assign(this.slotsLeft.style,t.slotsLeft.style),s.appendChild(this.slotsLeft);const i=document.createElement("div");i.className="ng-node-content",s.appendChild(i),this.bodyElement=document.createElement("div"),this.bodyElement.className="ng-node-body",t.body&&t.body.content&&(this.bodyElement.innerHTML=t.body.content),t.body&&t.body.className&&this.bodyElement.classList.add(t.body.className),t.body&&t.body.style&&Object.assign(this.bodyElement.style,t.body.style),i.appendChild(this.bodyElement),this.footerElement=document.createElement("div"),this.footerElement.className="ng-node-footer",t.footer&&t.footer.content?this._setContent(this.footerElement,t.footer.content):this.footerElement.style.display="none",t.footer&&t.footer.className&&this.footerElement.classList.add(t.footer.className),t.footer&&t.footer.style&&Object.assign(this.footerElement.style,t.footer.style),i.appendChild(this.footerElement),this.slotsRight=document.createElement("div"),this.slotsRight.className="ng-node-slots-right",t.slotsRight&&t.slotsRight.style&&Object.assign(this.slotsRight.style,t.slotsRight.style),s.appendChild(this.slotsRight),this.slotsBottom=document.createElement("div"),this.slotsBottom.className="ng-node-slots-bottom",t.slotsBottom&&t.slotsBottom.style&&Object.assign(this.slotsBottom.style,t.slotsBottom.style),e.appendChild(this.slotsBottom)}_setContent(t,e){e!=null&&(typeof e=="string"?e.trim().startsWith("<")?t.innerHTML=e:t.textContent=e:e instanceof HTMLElement&&t.appendChild(e))}_createSlots(t=[],e=[]){t.forEach(s=>{this.addInputSlot(s)}),e.forEach(s=>{this.addOutputSlot(s)})}_bindEvents(){let t=!1,e={x:0,y:0};const s=new Map,i=n=>{var l;if(n.target.closest(".ng-slot-click-area")||n.target.closest("input")||n.target.closest("button")||n.target.closest("select")||n.target.closest("textarea")||n.button!==0||(n.stopPropagation(),this.element.dispatchEvent(new CustomEvent("node:select",{bubbles:!0,detail:{node:this,event:n}})),!this.draggable))return;t=!0,e={x:n.clientX,y:n.clientY};const h=(l=this.graph)==null?void 0:l.selection;s.clear(),h&&h.isSelected(this)?h.getSelectedNodes().forEach(r=>{s.set(r,{...r.position}),r.element.classList.add("ng-node--dragging")}):(s.set(this,{...this.position}),this.element.classList.add("ng-node--dragging")),document.addEventListener("mousemove",a),document.addEventListener("mouseup",o)},a=n=>{var c,u;if(!t)return;const h=((u=(c=this.graph)==null?void 0:c.viewport)==null?void 0:u.scale)||1,l=(n.clientX-e.x)/h,r=(n.clientY-e.y)/h;s.forEach((y,T)=>{T.moveTo(y.x+l,y.y+r)}),this.element.dispatchEvent(new CustomEvent("node:drag",{bubbles:!0,detail:{node:this}}))},o=()=>{var n,h,l;if(t){if(t=!1,s.forEach((r,c)=>{c.element.classList.remove("ng-node--dragging")}),(h=(n=this.graph)==null?void 0:n.options)!=null&&h.snapToGrid){const r=((l=this.graph.options.grid)==null?void 0:l.step)||20;s.forEach((c,u)=>{u.moveTo(Math.round(u.position.x/r)*r,Math.round(u.position.y/r)*r)})}this.element.dispatchEvent(new CustomEvent("node:dragend",{bubbles:!0,detail:{node:this}})),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",o),s.clear()}};this.element.addEventListener("mousedown",i),this.element.addEventListener("contextmenu",n=>{n.preventDefault(),n.stopPropagation(),this.element.dispatchEvent(new CustomEvent("node:contextmenu",{bubbles:!0,detail:{node:this,event:n}}))})}_updatePosition(){this.element.style.transform=`translate(${this.position.x}px, ${this.position.y}px)`}_updateConnections(){this.inputSlots.forEach(t=>{t.connections.forEach(e=>e.updatePath())}),this.outputSlots.forEach(t=>{t.connections.forEach(e=>e.updatePath())}),this.connections.forEach(t=>t.updatePath())}moveTo(t,e){this.position.x=t,this.position.y=e,this._updatePosition(),this._updateConnections()}moveBy(t,e){this.moveTo(this.position.x+t,this.position.y+e)}addInputSlot(t){const e=new v({...t,node:this,type:"input"});this.inputSlots.set(e.id,e);const s=t.side||"left";return s==="top"?this.slotsTop.appendChild(e.element):s==="bottom"?this.slotsBottom.appendChild(e.element):s==="right"?this.slotsRight.appendChild(e.element):this.slotsLeft.appendChild(e.element),e}addOutputSlot(t){const e=new v({...t,node:this,type:"output"});this.outputSlots.set(e.id,e);const s=t.side||"right";return s==="top"?this.slotsTop.appendChild(e.element):s==="bottom"?this.slotsBottom.appendChild(e.element):s==="left"?this.slotsLeft.appendChild(e.element):this.slotsRight.appendChild(e.element),e}getInput(t){return this.inputSlots.get(t)}getOutput(t){return this.outputSlots.get(t)}removeSlot(t){this.inputSlots.has(t)?(this.inputSlots.get(t).destroy(),this.inputSlots.delete(t)):this.outputSlots.has(t)&&(this.outputSlots.get(t).destroy(),this.outputSlots.delete(t))}setHeader(t){this.headerElement&&this._setContent(this.headerElement,t)}setBody(t){this.bodyElement&&this._setContent(this.bodyElement,t)}setFooter(t){this.footerElement&&this._setContent(this.footerElement,t)}select(){this.selected=!0,this.element.classList.add("ng-node--selected")}deselect(){this.selected=!1,this.element.classList.remove("ng-node--selected")}getBounds(){const t=this.element.getBoundingClientRect();return{x:this.position.x,y:this.position.y,width:t.width,height:t.height}}destroy(){this.inputSlots.forEach(t=>t.destroy()),this.outputSlots.forEach(t=>t.destroy()),this.inputSlots.clear(),this.outputSlots.clear(),this.connections.forEach(t=>t.destroy()),this.connections.clear(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}serialize(){return{id:this.id,position:{...this.position},header:this.headerElement?{content:this.headerElement.innerHTML}:null,body:this.bodyElement?{content:this.bodyElement.innerHTML}:null,footer:this.footerElement?{content:this.footerElement.innerHTML}:null,inputs:Array.from(this.inputSlots.values()).map(t=>t.serialize()),outputs:Array.from(this.outputSlots.values()).map(t=>t.serialize())}}getConnectionPoint(){const t=this.element.getBoundingClientRect(),e=t.width||200,s=t.height||100;return{x:this.position.x+e/2,y:this.position.y+s/2}}get orientation(){return"horizontal"}}function x(d,t,e="horizontal",s="horizontal"){const i=t.x-d.x,a=t.y-d.y;let o,n,h,l;const r=Math.min(Math.abs(i)/2,Math.abs(a)/2,100),u=Math.max(r,50);return e==="horizontal"?(o=d.x+u,n=d.y):(o=d.x,n=d.y+u),s==="horizontal"?(h=t.x-u,l=t.y):(h=t.x,l=t.y-u),`M ${d.x} ${d.y} C ${o} ${n}, ${h} ${l}, ${t.x} ${t.y}`}function z(d,t){return{x:(d.x+t.x)/2,y:(d.y+t.y)/2}}class b{constructor(t){var e,s,i;this.id=t.id||g("conn"),this.outputSlot=t.outputSlot,this.inputSlot=t.inputSlot,this.svgLayer=t.svgLayer,this.style={color:((e=t.style)==null?void 0:e.color)||"#667eea",width:((s=t.style)==null?void 0:s.width)||2,dashed:((i=t.style)==null?void 0:i.dashed)||!1,...t.style},this.selected=!1,this._createPath(),this._bindEvents()}_createPath(){this.pathElement=document.createElementNS("http://www.w3.org/2000/svg","path"),this.pathElement.classList.add("ng-connection"),this.pathElement.dataset.connectionId=this.id,this._applyStyle(),this.updatePath(),this.svgLayer.appendChild(this.pathElement)}_applyStyle(){this.pathElement.setAttribute("stroke",this.style.color),this.pathElement.setAttribute("stroke-width",this.style.width),this.pathElement.setAttribute("fill","none"),this.style.dashed?this.pathElement.setAttribute("stroke-dasharray","8,4"):this.pathElement.removeAttribute("stroke-dasharray")}_bindEvents(){this.pathElement.addEventListener("click",t=>{t.stopPropagation(),this.select()}),this.pathElement.addEventListener("mouseenter",()=>{this.pathElement.classList.add("ng-connection--hover")}),this.pathElement.addEventListener("mouseleave",()=>{this.pathElement.classList.remove("ng-connection--hover")})}updatePath(){const t=this.outputSlot.getConnectionPoint(),e=this.inputSlot.getConnectionPoint(),s=this.outputSlot.orientation||"horizontal",i=this.inputSlot.orientation||"horizontal",a=x(t,e,s,i);this.pathElement.setAttribute("d",a)}select(){this.selected=!0,this.pathElement.classList.add("ng-connection--selected")}deselect(){this.selected=!1,this.pathElement.classList.remove("ng-connection--selected")}setStyle(t){this.style={...this.style,...t},this._applyStyle()}destroy(){this.outputSlot&&this.outputSlot.connections&&this.outputSlot.connections.delete(this),this.inputSlot&&this.inputSlot.connections&&this.inputSlot.connections.delete(this),this.pathElement&&this.pathElement.parentNode&&this.pathElement.parentNode.removeChild(this.pathElement)}serialize(){const t=i=>i.node?{nodeId:i.node.id,slotId:i.id}:{nodeId:i.id,slotId:null},e=t(this.outputSlot),s=t(this.inputSlot);return{id:this.id,outputNodeId:e.nodeId,outputSlotId:e.slotId,inputNodeId:s.nodeId,inputSlotId:s.slotId,style:{...this.style}}}}class w{constructor(t){var e,s,i,a;this.id=t.id||g("group"),this.graph=t.graph,this.label=t.label||"Group",this.color=t.color||"rgba(102, 126, 234, 0.1)",this.position={x:((e=t.position)==null?void 0:e.x)||0,y:((s=t.position)==null?void 0:s.y)||0},this.size={width:((i=t.size)==null?void 0:i.width)||200,height:((a=t.size)==null?void 0:a.height)||150},this.padding=t.padding||20,this.nodes=new Set,this._createElement(),this._bindEvents(),this._updateStyle()}_createElement(){this.element=document.createElement("div"),this.element.className="ng-group",this.element.dataset.groupId=this.id,this.headerElement=document.createElement("div"),this.headerElement.className="ng-group-header",this.labelElement=document.createElement("span"),this.labelElement.className="ng-group-label",this.labelElement.textContent=this.label,this.labelElement.contentEditable=!1,this.headerElement.appendChild(this.labelElement),this.element.appendChild(this.headerElement),this.resizeHandle=document.createElement("div"),this.resizeHandle.className="ng-group-resize-handle",this.element.appendChild(this.resizeHandle),this._updatePosition(),this._updateSize()}_bindEvents(){let t=!1,e=!1,s={x:0,y:0},i={x:0,y:0},a={width:0,height:0};this.headerElement.addEventListener("mousedown",o=>{if(o.button!==0)return;o.stopPropagation(),t=!0,s={x:o.clientX,y:o.clientY},i={...this.position};const n=[],h=this._getGraphRect();this.graph.nodes.forEach(l=>{const r=l.getBounds();this._rectsIntersect(h,r)&&n.push(l)}),this.collidingNodes=n,this.element.classList.add("ng-group--dragging")}),this.resizeHandle.addEventListener("mousedown",o=>{o.button===0&&(o.stopPropagation(),e=!0,s={x:o.clientX,y:o.clientY},a={...this.size},this.element.classList.add("ng-group--resizing"))}),document.addEventListener("mousemove",o=>{var h,l;const n=((l=(h=this.graph)==null?void 0:h.viewport)==null?void 0:l.scale)||1;if(t){const r=(o.clientX-s.x)/n,c=(o.clientY-s.y)/n;this.position.x=i.x+r,this.position.y=i.y+c,this._updatePosition(),this.collidingNodes&&(this.collidingNodes.forEach(u=>{u.moveBy(r-(this.lastDx||0),c-(this.lastDy||0))}),this.lastDx=r,this.lastDy=c)}if(e){const r=(o.clientX-s.x)/n,c=(o.clientY-s.y)/n;this.size.width=Math.max(100,a.width+r),this.size.height=Math.max(60,a.height+c),this._updateSize(),a={...this.size},s={x:o.clientX,y:o.clientY}}}),document.addEventListener("mouseup",()=>{t&&(t=!1,this.element.classList.remove("ng-group--dragging"),this.collidingNodes=null,this.lastDx=0,this.lastDy=0),e&&(e=!1,this.element.classList.remove("ng-group--resizing"))}),this.labelElement.addEventListener("dblclick",o=>{o.stopPropagation(),this._startEditLabel()}),this.element.addEventListener("contextmenu",o=>{o.preventDefault(),o.stopPropagation(),this.element.dispatchEvent(new CustomEvent("group:contextmenu",{bubbles:!0,detail:{group:this,event:o}}))})}_startEditLabel(){this.labelElement.contentEditable=!0,this.labelElement.focus();const t=document.createRange();t.selectNodeContents(this.labelElement);const e=window.getSelection();e.removeAllRanges(),e.addRange(t);const s=()=>{this.labelElement.contentEditable=!1,this.label=this.labelElement.textContent||"Group",this.labelElement.removeEventListener("blur",s),this.labelElement.removeEventListener("keydown",i)},i=a=>{a.key==="Enter"&&(a.preventDefault(),s()),a.key==="Escape"&&(this.labelElement.textContent=this.label,s())};this.labelElement.addEventListener("blur",s),this.labelElement.addEventListener("keydown",i)}_updatePosition(){this.element.style.transform=`translate(${this.position.x}px, ${this.position.y}px)`}_updateSize(){this.element.style.width=`${this.size.width}px`,this.element.style.height=`${this.size.height}px`}_updateStyle(){this.element.style.backgroundColor=this.color}addNode(t){this.nodes.add(t),t.group=this}removeNode(t){this.nodes.delete(t),t.group===this&&(t.group=null)}setLabel(t){this.label=t,this.labelElement.textContent=t}setColor(t){this.color=t,this._updateStyle()}fitToNodes(){if(this.nodes.size===0)return;let t=1/0,e=1/0,s=-1/0,i=-1/0;this.nodes.forEach(a=>{const o=a.getBounds();t=Math.min(t,o.x),e=Math.min(e,o.y),s=Math.max(s,o.x+o.width),i=Math.max(i,o.y+o.height)}),this.position.x=t-this.padding,this.position.y=e-this.padding-30,this.size.width=s-t+this.padding*2,this.size.height=i-e+this.padding*2+30,this._updatePosition(),this._updateSize()}_getGraphRect(){return{left:this.position.x,top:this.position.y,right:this.position.x+this.size.width,bottom:this.position.y+this.size.height,width:this.size.width,height:this.size.height}}_rectsIntersect(t,e){const s=t.left+t.width,i=t.top+t.height,a=e.x+e.width,o=e.y+e.height;return!(t.left>a||s<e.x||t.top>o||i<e.y)}destroy(){this.nodes.forEach(t=>{t.group===this&&(t.group=null)}),this.nodes.clear(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}serialize(){return{id:this.id,label:this.label,color:this.color,position:{...this.position},size:{...this.size},nodeIds:Array.from(this.nodes).map(t=>t.id)}}}class C{constructor(t){var e,s,i,a;this.container=t.container,this.content=t.content,this.options={minZoom:((e=t.options)==null?void 0:e.minZoom)||.1,maxZoom:((s=t.options)==null?void 0:s.maxZoom)||4,zoomSpeed:((i=t.options)==null?void 0:i.zoomSpeed)||.1,panButton:((a=t.options)==null?void 0:a.panButton)||1,...t.options},this.scale=1,this.panX=0,this.panY=0,this._isPanning=!1,this._panStartX=0,this._panStartY=0,this._spacePressed=!1,this._bindEvents()}get isPanningWithSpace(){return this._spacePressed}_bindEvents(){this.container.addEventListener("wheel",t=>{t.preventDefault();const e=this.container.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top,o=1+(t.deltaY>0?-1:1)*this.options.zoomSpeed;this.zoomAt(s,i,o)},{passive:!1}),this.container.addEventListener("mousedown",t=>{(t.button===this.options.panButton||t.button===0&&this._spacePressed)&&(t.preventDefault(),this._startPan(t))}),document.addEventListener("mousemove",_(t=>{this._isPanning&&this._updatePan(t)},16)),document.addEventListener("mouseup",t=>{this._isPanning&&this._endPan()}),document.addEventListener("keydown",t=>{t.code==="Space"&&!this._spacePressed&&(this._spacePressed=!0,this.container.style.cursor="grab")}),document.addEventListener("keyup",t=>{t.code==="Space"&&(this._spacePressed=!1,this.container.style.cursor="")})}_startPan(t){this._isPanning=!0,this._panStartX=t.clientX-this.panX,this._panStartY=t.clientY-this.panY,this.container.style.cursor="grabbing"}_updatePan(t){this.panX=t.clientX-this._panStartX,this.panY=t.clientY-this._panStartY,this._applyTransform()}_endPan(){this._isPanning=!1,this.container.style.cursor=this._spacePressed?"grab":""}_applyTransform(){this.content.style.transform=`translate(${this.panX}px, ${this.panY}px) scale(${this.scale})`}zoomAt(t,e,s){const i=Math.min(Math.max(this.scale*s,this.options.minZoom),this.options.maxZoom);if(i===this.scale)return;const a=i/this.scale;this.panX=t-(t-this.panX)*a,this.panY=e-(e-this.panY)*a,this.scale=i,this._applyTransform()}setZoom(t){this.scale=Math.min(Math.max(t,this.options.minZoom),this.options.maxZoom),this._applyTransform()}setPan(t,e){this.panX=t,this.panY=e,this._applyTransform()}reset(){this.scale=1,this.panX=0,this.panY=0,this._applyTransform()}centerOn(t,e){const s=this.container.getBoundingClientRect();this.panX=s.width/2-t*this.scale,this.panY=s.height/2-e*this.scale,this._applyTransform()}screenToGraph(t,e){const s=this.container.getBoundingClientRect();return{x:(t-s.left-this.panX)/this.scale,y:(e-s.top-this.panY)/this.scale}}graphToScreen(t,e){const s=this.container.getBoundingClientRect();return{x:t*this.scale+this.panX+s.left,y:e*this.scale+this.panY+s.top}}getState(){return{scale:this.scale,panX:this.panX,panY:this.panY}}setState(t){t.scale!==void 0&&(this.scale=t.scale),t.panX!==void 0&&(this.panX=t.panX),t.panY!==void 0&&(this.panY=t.panY),this._applyTransform()}}class L{constructor(t){this.graph=t,this.selectedNodes=new Set,this.selectedConnections=new Set,this._isBoxSelecting=!1,this._boxStart={x:0,y:0},this._boxElement=null,this._bindEvents()}_bindEvents(){this.graph.container.addEventListener("mousedown",t=>{t.button===0&&(this.graph.viewport.isPanningWithSpace||t.target!==this.graph.container&&t.target!==this.graph.nodesLayer&&!t.target.classList.contains("ng-viewport")||(!t.ctrlKey&&!t.metaKey&&this.clearSelection(),this._startBoxSelection(t)))}),document.addEventListener("mousemove",t=>{this._isBoxSelecting&&this._updateBoxSelection(t)}),document.addEventListener("mouseup",()=>{this._isBoxSelecting&&this._endBoxSelection()}),document.addEventListener("keydown",t=>{(t.key==="Delete"||t.key==="Backspace")&&document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="TEXTAREA"&&this.deleteSelected(),(t.ctrlKey||t.metaKey)&&t.key==="a"&&document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="TEXTAREA"&&(t.preventDefault(),this.selectAll()),t.key==="Escape"&&this.clearSelection()})}_startBoxSelection(t){const e=this.graph.viewport.screenToGraph(t.clientX,t.clientY);this._boxStart=e,this._isBoxSelecting=!0,this._boxElement=document.createElement("div"),this._boxElement.className="ng-selection-box",this._boxElement.style.left=`${e.x}px`,this._boxElement.style.top=`${e.y}px`,this._boxElement.style.width="0",this._boxElement.style.height="0",this.graph.nodesLayer.appendChild(this._boxElement)}_updateBoxSelection(t){const e=this.graph.viewport.screenToGraph(t.clientX,t.clientY),s=Math.min(this._boxStart.x,e.x),i=Math.min(this._boxStart.y,e.y),a=Math.abs(e.x-this._boxStart.x),o=Math.abs(e.y-this._boxStart.y);this._boxElement.style.left=`${s}px`,this._boxElement.style.top=`${i}px`,this._boxElement.style.width=`${a}px`,this._boxElement.style.height=`${o}px`}_endBoxSelection(){if(!this._boxElement)return;const t={left:parseFloat(this._boxElement.style.left),top:parseFloat(this._boxElement.style.top),width:parseFloat(this._boxElement.style.width),height:parseFloat(this._boxElement.style.height)};t.right=t.left+t.width,t.bottom=t.top+t.height,this.graph.nodes.forEach(e=>{const s=e.getBounds();this._rectsIntersect(t,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})&&this.addToSelection(e)}),this._boxElement.remove(),this._boxElement=null,this._isBoxSelecting=!1}_rectsIntersect(t,e){return!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom)}selectNode(t,e=!1){e||this.clearSelection(),this.addToSelection(t)}addToSelection(t){this.selectedNodes.has(t)||(this.selectedNodes.add(t),t.select(),this.graph.emit("selection:change",{nodes:Array.from(this.selectedNodes)}))}removeFromSelection(t){this.selectedNodes.has(t)&&(this.selectedNodes.delete(t),t.deselect(),this.graph.emit("selection:change",{nodes:Array.from(this.selectedNodes)}))}toggleSelection(t){this.selectedNodes.has(t)?this.removeFromSelection(t):this.addToSelection(t)}selectConnection(t){this.clearConnectionSelection(),this.selectedConnections.add(t),t.select()}clearConnectionSelection(){this.selectedConnections.forEach(t=>t.deselect()),this.selectedConnections.clear()}clearSelection(){this.selectedNodes.forEach(t=>t.deselect()),this.selectedNodes.clear(),this.clearConnectionSelection(),this.graph.emit("selection:change",{nodes:[]})}selectAll(){this.graph.nodes.forEach(t=>{this.addToSelection(t)})}deleteSelected(){this.selectedConnections.forEach(t=>{this.graph.disconnect(t.id)}),this.selectedConnections.clear(),this.selectedNodes.forEach(t=>{this.graph.removeNode(t.id)}),this.selectedNodes.clear(),this.graph.emit("selection:change",{nodes:[]})}getSelectedNodes(){return Array.from(this.selectedNodes)}isSelected(t){return this.selectedNodes.has(t)}}class N{constructor(t){var e,s,i,a,o;this.svgLayer=t.svgLayer,this.options={enabled:((e=t.options)==null?void 0:e.enabled)!==!1,step:((s=t.options)==null?void 0:s.step)||20,color:((i=t.options)==null?void 0:i.color)||"rgba(255,255,255,0.05)",majorLineEvery:((a=t.options)==null?void 0:a.majorLineEvery)||5,majorColor:((o=t.options)==null?void 0:o.majorColor)||"rgba(255,255,255,0.1)",...t.options},this._gridGroup=null,this._pattern=null,this.options.enabled&&this._createGrid()}_createGrid(){let t=this.svgLayer.querySelector("defs");t||(t=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.svgLayer.insertBefore(t,this.svgLayer.firstChild));const e=this.options.step,s=e*this.options.majorLineEvery;this._pattern=document.createElementNS("http://www.w3.org/2000/svg","pattern"),this._pattern.setAttribute("id","ng-grid-pattern"),this._pattern.setAttribute("width",s),this._pattern.setAttribute("height",s),this._pattern.setAttribute("patternUnits","userSpaceOnUse");for(let a=0;a<=this.options.majorLineEvery;a++){const o=a*e,n=a*e,h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",o),h.setAttribute("y1",0),h.setAttribute("x2",o),h.setAttribute("y2",s),h.setAttribute("stroke",a===0?this.options.majorColor:this.options.color),h.setAttribute("stroke-width",a===0?1:.5),this._pattern.appendChild(h);const l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",0),l.setAttribute("y1",n),l.setAttribute("x2",s),l.setAttribute("y2",n),l.setAttribute("stroke",a===0?this.options.majorColor:this.options.color),l.setAttribute("stroke-width",a===0?1:.5),this._pattern.appendChild(l)}t.appendChild(this._pattern),this._gridGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this._gridGroup.classList.add("ng-grid");const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x",-1e4),i.setAttribute("y",-1e4),i.setAttribute("width",2e4),i.setAttribute("height",2e4),i.setAttribute("fill","url(#ng-grid-pattern)"),this._gridGroup.appendChild(i),this.svgLayer.insertBefore(this._gridGroup,this.svgLayer.firstChild.nextSibling)}show(){this.options.enabled=!0,this._gridGroup?this._gridGroup.style.display="":this._createGrid()}hide(){this.options.enabled=!1,this._gridGroup&&(this._gridGroup.style.display="none")}toggle(){this.options.enabled?this.hide():this.show()}setStep(t){this.options.step=t,this._destroyGrid(),this._createGrid()}snap(t,e){const s=this.options.step;return{x:Math.round(t/s)*s,y:Math.round(e/s)*s}}_destroyGrid(){this._gridGroup&&(this._gridGroup.remove(),this._gridGroup=null),this._pattern&&(this._pattern.remove(),this._pattern=null)}destroy(){this._destroyGrid()}}class I{constructor(t){this.graph=t,this.menuElement=null,this.isOpen=!1,this.menuItems={canvas:[],node:[],group:[],connection:[]},this._registerDefaultItems(),this._bindEvents()}_registerDefaultItems(){this.addItem("canvas",{id:"add-node",label:"Add Node",icon:"âž•",action:t=>{this.graph.emit("canvas:add-node",t.position)}}),this.addItem("canvas",{id:"add-group",label:"Add Group",icon:"ðŸ“",action:t=>{this.graph.addGroup({label:"New Group",position:t.position,size:{width:300,height:200}})}}),this.addItem("canvas",{type:"separator"}),this.addItem("canvas",{id:"paste",label:"Paste",icon:"ðŸ“‹",shortcut:"Ctrl+V",action:()=>{var t;return(t=this.graph.clipboard)==null?void 0:t.paste()},enabled:()=>{var t;return(t=this.graph.clipboard)==null?void 0:t.hasData()}}),this.addItem("canvas",{id:"select-all",label:"Select All",icon:"â˜‘ï¸",shortcut:"Ctrl+A",action:()=>{var t;return(t=this.graph.selection)==null?void 0:t.selectAll()}}),this.addItem("canvas",{type:"separator"}),this.addItem("canvas",{id:"toggle-grid",label:"Toggle Grid",icon:"âŠž",action:()=>{var t;return(t=this.graph.grid)==null?void 0:t.toggle()}}),this.addItem("canvas",{id:"reset-view",label:"Reset View",icon:"ðŸ ",action:()=>{var t;return(t=this.graph.viewport)==null?void 0:t.reset()}}),this.addItem("node",{id:"copy",label:"Copy",icon:"ðŸ“„",shortcut:"Ctrl+C",action:t=>{var e;return(e=this.graph.clipboard)==null?void 0:e.copy()}}),this.addItem("node",{id:"cut",label:"Cut",icon:"âœ‚ï¸",shortcut:"Ctrl+X",action:()=>{var t;return(t=this.graph.clipboard)==null?void 0:t.cut()}}),this.addItem("node",{id:"duplicate",label:"Duplicate",icon:"â§‰",shortcut:"Ctrl+D",action:()=>{var t;return(t=this.graph.clipboard)==null?void 0:t.duplicate()}}),this.addItem("node",{type:"separator"}),this.addItem("node",{id:"delete",label:"Delete",icon:"ðŸ—‘ï¸",shortcut:"Del",action:()=>{var t;return(t=this.graph.selection)==null?void 0:t.deleteSelected()},className:"ng-context-menu-item--danger"}),this.addItem("group",{id:"rename",label:"Rename Group",icon:"âœŽ",action:t=>t.group._startEditLabel()}),this.addItem("group",{id:"color",label:"Change Color",icon:"ðŸŽ¨",action:t=>{const e=document.createElement("input");e.type="color",e.value="#667eea",e.style.position="absolute",e.style.opacity="0",e.style.pointerEvents="none",document.body.appendChild(e),e.addEventListener("input",s=>{const i=s.target.value,a=parseInt(i.slice(1,3),16),o=parseInt(i.slice(3,5),16),n=parseInt(i.slice(5,7),16);t.group.setColor(`rgba(${a}, ${o}, ${n}, 0.1)`)}),e.addEventListener("change",()=>{e.remove()}),e.click()}}),this.addItem("group",{type:"separator"}),this.addItem("group",{id:"delete-group",label:"Delete Group",icon:"ðŸ—‘ï¸",action:t=>this.graph.removeGroup(t.group.id),className:"ng-context-menu-item--danger"}),this.addItem("connection",{id:"delete-connection",label:"Delete Connection",icon:"ðŸ—‘ï¸",action:t=>{t.connection&&this.graph.disconnect(t.connection.id)},className:"ng-context-menu-item--danger"})}_bindEvents(){document.addEventListener("click",t=>{var e;this.isOpen&&!((e=this.menuElement)!=null&&e.contains(t.target))&&this.close()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.isOpen&&this.close()}),this.graph.container.addEventListener("wheel",()=>{this.isOpen&&this.close()})}addItem(t,e){this.menuItems[t]||(this.menuItems[t]=[]),this.menuItems[t].push(e)}removeItem(t,e){this.menuItems[t]&&(this.menuItems[t]=this.menuItems[t].filter(s=>s.id!==e))}open(t,e,s,i={}){this.close();const a=this.menuItems[t];if(!a||a.length===0)return;this.menuElement=document.createElement("div"),this.menuElement.className="ng-context-menu",a.forEach(n=>{if(n.type==="separator"){const c=document.createElement("div");c.className="ng-context-menu-separator",this.menuElement.appendChild(c);return}const h=n.enabled?n.enabled(i):!0,l=document.createElement("div");if(l.className="ng-context-menu-item",n.className&&l.classList.add(n.className),h||l.classList.add("ng-context-menu-item--disabled"),n.icon){const c=document.createElement("span");c.className="ng-context-menu-icon",c.textContent=n.icon,l.appendChild(c)}const r=document.createElement("span");if(r.className="ng-context-menu-label",r.textContent=n.label,l.appendChild(r),n.shortcut){const c=document.createElement("span");c.className="ng-context-menu-shortcut",c.textContent=n.shortcut,l.appendChild(c)}h&&n.action&&l.addEventListener("click",c=>{c.stopPropagation(),n.action(i),this.close()}),this.menuElement.appendChild(l)}),this.menuElement.style.left=`${e}px`,this.menuElement.style.top=`${s}px`,document.body.appendChild(this.menuElement),this.isOpen=!0;const o=this.menuElement.getBoundingClientRect();o.right>window.innerWidth&&(this.menuElement.style.left=`${e-o.width}px`),o.bottom>window.innerHeight&&(this.menuElement.style.top=`${s-o.height}px`)}close(){this.menuElement&&(this.menuElement.remove(),this.menuElement=null),this.isOpen=!1}destroy(){this.close()}}class P{constructor(t){this.graph=t,this._clipboardData=null,this._bindEvents()}_bindEvents(){document.addEventListener("keydown",t=>{if(document.activeElement.tagName==="INPUT"||document.activeElement.tagName==="TEXTAREA")return;const s=navigator.platform.toUpperCase().indexOf("MAC")>=0?t.metaKey:t.ctrlKey;s&&t.key==="c"?(t.preventDefault(),this.copy()):s&&t.key==="x"?(t.preventDefault(),this.cut()):s&&t.key==="v"?(t.preventDefault(),this.paste()):s&&t.key==="d"&&(t.preventDefault(),this.duplicate())})}copy(){var n;const t=((n=this.graph.selection)==null?void 0:n.getSelectedNodes())||[];if(t.length===0)return;let e=1/0,s=1/0;t.forEach(h=>{e=Math.min(e,h.position.x),s=Math.min(s,h.position.y)});const i=t.map(h=>{const l=h.serialize();return l.position.x-=e,l.position.y-=s,l}),a=new Set(t.map(h=>h.id)),o=[];this.graph.connections.forEach(h=>{a.has(h.outputSlot.node.id)&&a.has(h.inputSlot.node.id)&&o.push(h.serialize())}),this._clipboardData={nodes:i,connections:o},this.graph.emit("clipboard:copy",{nodes:t})}cut(){var t;this.copy(),(t=this.graph.selection)==null||t.deleteSelected(),this.graph.emit("clipboard:cut",{})}paste(){var a,o;if(!this._clipboardData)return;let t,e;if(this.graph.lastMousePos){const n=this.graph.viewport.screenToGraph(this.graph.lastMousePos.x,this.graph.lastMousePos.y);t=n.x,e=n.y}else{const n=((a=this.graph.viewport)==null?void 0:a.getState())||{panX:0,panY:0,scale:1},h=this.graph.container.getBoundingClientRect();t=(h.width/2-n.panX)/n.scale,e=(h.height/2-n.panY)/n.scale}const s=new Map;(o=this.graph.selection)==null||o.clearSelection();const i=[];this._clipboardData.nodes.forEach(n=>{var r;const h=n.id,l=this.graph.addNode({...n,id:void 0,position:{x:t+n.position.x,y:e+n.position.y}});s.set(h,l.id),i.push(l),(r=this.graph.selection)==null||r.addToSelection(l)}),this._clipboardData.connections.forEach(n=>{const h=s.get(n.outputNodeId),l=s.get(n.inputNodeId);if(h&&l){const r=this.graph.getNode(h),c=this.graph.getNode(l);if(r&&c){const u=r.getOutput(n.outputSlotId),y=c.getInput(n.inputSlotId);u&&y&&this.graph.connect(u,y,n.style)}}}),this.graph.emit("clipboard:paste",{nodes:i})}duplicate(){var i;if((((i=this.graph.selection)==null?void 0:i.getSelectedNodes())||[]).length===0)return;const e=this._clipboardData,s=this.graph.lastMousePos;this.copy(),this.paste(),this._clipboardData=e,this.graph.lastMousePos=s}hasData(){return this._clipboardData!==null&&this._clipboardData.nodes.length>0}clear(){this._clipboardData=null}}class A extends m{constructor(t,e={}){if(super(),typeof t=="string"?this.container=document.querySelector(t):this.container=t,!this.container)throw new Error("NodeGraph: Container element not found");this.options={grid:{enabled:!0,step:20,...e.grid},zoom:{min:.1,max:4,speed:.1,...e.zoom},snapToGrid:e.snapToGrid!==!1,...e},this.nodes=new Map,this.connections=new Map,this.groups=new Map,this._connectionDrag=null,this._tempPath=null,this._createLayers(),this._initManagers(),this._bindEvents()}_createLayers(){this.container.classList.add("ng-container"),this.viewportElement=document.createElement("div"),this.viewportElement.className="ng-viewport",this.groupsLayer=document.createElement("div"),this.groupsLayer.className="ng-groups-layer",this.viewportElement.appendChild(this.groupsLayer),this.svgLayer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgLayer.classList.add("ng-svg-layer"),this.svgLayer.setAttribute("width","100%"),this.svgLayer.setAttribute("height","100%"),this.viewportElement.appendChild(this.svgLayer),this.connectionsGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.connectionsGroup.classList.add("ng-connections"),this.svgLayer.appendChild(this.connectionsGroup),this.nodesLayer=document.createElement("div"),this.nodesLayer.className="ng-nodes-layer",this.viewportElement.appendChild(this.nodesLayer),this.container.appendChild(this.viewportElement)}_initManagers(){this.viewport=new C({container:this.container,content:this.viewportElement,options:this.options.zoom}),this.selection=new L(this),this.grid=new N({svgLayer:this.svgLayer,options:this.options.grid}),this.contextMenu=new I(this),this.clipboard=new P(this)}_bindEvents(){this.nodesLayer.addEventListener("node:select",t=>{const{node:e,event:s}=t.detail;s.ctrlKey||s.metaKey?this.selection.toggleSelection(e):this.selection.isSelected(e)||this.selection.selectNode(e),this.emit("node:select",e)}),this.nodesLayer.addEventListener("node:drag",t=>{const{node:e}=t.detail;this.selection.isSelected(e)&&this.selection.selectedNodes.size>1,this.emit("node:drag",e)}),this.nodesLayer.addEventListener("node:dragend",t=>{this.emit("node:dragend",t.detail.node)}),this.nodesLayer.addEventListener("node:contextmenu",t=>{const{node:e,event:s}=t.detail;this.selection.isSelected(e)||this.selection.selectNode(e),this.contextMenu.open("node",s.clientX,s.clientY,{node:e})}),this.nodesLayer.addEventListener("slot:dragstart",t=>{const{slot:e,event:s}=t.detail;this._startConnectionDrag(e,s)}),this.container.addEventListener("contextmenu",t=>{if(t.target===this.container||t.target===this.viewportElement||t.target===this.nodesLayer||t.target.classList.contains("ng-viewport")){t.preventDefault();const e=this.viewport.screenToGraph(t.clientX,t.clientY);this.contextMenu.open("canvas",t.clientX,t.clientY,{position:e})}}),this.groupsLayer.addEventListener("group:contextmenu",t=>{const{group:e,event:s}=t.detail;this.contextMenu.open("group",s.clientX,s.clientY,{group:e})}),document.addEventListener("mousemove",t=>{this.lastMousePos={x:t.clientX,y:t.clientY},this._connectionDrag&&this._updateConnectionDrag(t)}),document.addEventListener("mouseup",t=>{this._connectionDrag&&this._endConnectionDrag(t)})}_startConnectionDrag(t,e){this._connectionDrag={sourceSlot:t,startPos:t.getConnectionPoint()},this._tempPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this._tempPath.classList.add("ng-connection","ng-connection--temp"),this._tempPath.setAttribute("stroke",t.color),this._tempPath.setAttribute("stroke-width","2"),this._tempPath.setAttribute("fill","none"),this._tempPath.setAttribute("stroke-dasharray","5,5"),this.svgLayer.appendChild(this._tempPath),this._updateConnectionDrag(e)}_updateConnectionDrag(t){if(!this._connectionDrag||!this._tempPath)return;const e=this.viewport.screenToGraph(t.clientX,t.clientY),s=this._connectionDrag.startPos,i=this._connectionDrag.sourceSlot.orientation,a=e.x-s.x,o=Math.max(Math.abs(a)/2,50);let n;i==="horizontal"?n=`M ${s.x} ${s.y} C ${s.x+o} ${s.y}, ${e.x-o} ${e.y}, ${e.x} ${e.y}`:n=`M ${s.x} ${s.y} C ${s.x} ${s.y+o}, ${e.x} ${e.y-o}, ${e.x} ${e.y}`,this._tempPath.setAttribute("d",n)}_endConnectionDrag(t){if(!this._connectionDrag)return;const e=document.elementFromPoint(t.clientX,t.clientY),s=e==null?void 0:e.closest(".ng-slot-click-area"),i=s==null?void 0:s.closest(".ng-slot");if(i){const a=i.dataset.slotId;i.dataset.slotType;const o=this._findSlotById(a);if(o&&o!==this._connectionDrag.sourceSlot){const n=this._connectionDrag.sourceSlot;n.type==="output"&&o.type==="input"?this.connect(n,o):n.type==="input"&&o.type==="output"&&this.connect(o,n)}}this._tempPath&&(this._tempPath.remove(),this._tempPath=null),this._connectionDrag=null}_findSlotById(t){for(const e of this.nodes.values()){if(e.inputSlots.has(t))return e.inputSlots.get(t);if(e.outputSlots.has(t))return e.outputSlots.get(t)}return null}addNode(t){const e=new S({...t,graph:this});return this.nodes.set(e.id,e),this.nodesLayer.appendChild(e.element),this.emit("node:add",e),e}removeNode(t){const e=this.nodes.get(t);e&&(this.selection.removeFromSelection(e),e.destroy(),this.nodes.delete(t),this.emit("node:remove",t))}getNode(t){return this.nodes.get(t)}connect(t,e,s={}){if(t.type!=="output"||e.type!=="input")return console.warn("NodeGraph: Invalid connection - must be output to input"),null;for(const a of this.connections.values())if(a.outputSlot===t&&a.inputSlot===e)return a;const i=new b({outputSlot:t,inputSlot:e,svgLayer:this.connectionsGroup,style:s});return t.connections.add(i),e.connections.add(i),this.connections.set(i.id,i),this.emit("connection:create",i),i}connectSymbolic(t,e,s={}){const i=new b({outputSlot:t,inputSlot:e,svgLayer:this.connectionsGroup,style:{dashed:!0,...s}});return this.connections.set(i.id,i),t.connections&&t.connections.add(i),e.connections&&e.connections.add(i),this.emit("connection:create",i),i}disconnect(t){const e=this.connections.get(t);e&&(e.destroy(),this.connections.delete(t),this.emit("connection:remove",t))}addGroup(t){const e=new w({...t,graph:this});return this.groups.set(e.id,e),this.groupsLayer.appendChild(e.element),this.emit("group:add",e),e}removeGroup(t){const e=this.groups.get(t);e&&(e.destroy(),this.groups.delete(t),this.emit("group:remove",t))}clear(){this.connections.forEach(t=>t.destroy()),this.connections.clear(),this.nodes.forEach(t=>t.destroy()),this.nodes.clear(),this.groups.forEach(t=>t.destroy()),this.groups.clear(),this.selection.clearSelection(),this.emit("graph:clear")}serialize(){return{nodes:Array.from(this.nodes.values()).map(t=>t.serialize()),connections:Array.from(this.connections.values()).map(t=>t.serialize()),groups:Array.from(this.groups.values()).map(t=>t.serialize()),viewport:this.viewport.getState()}}deserialize(t){this.clear(),t.nodes&&t.nodes.forEach(e=>{this.addNode(e)}),t.connections&&t.connections.forEach(e=>{const s=this.nodes.get(e.outputNodeId),i=this.nodes.get(e.inputNodeId);if(s&&i){const a=s.getOutput(e.outputSlotId),o=i.getInput(e.inputSlotId);a&&o&&this.connect(a,o,e.style)}}),t.groups&&t.groups.forEach(e=>{const s=this.addGroup(e);e.nodeIds&&e.nodeIds.forEach(i=>{const a=this.nodes.get(i);a&&s.addNode(a)})}),t.viewport&&this.viewport.setState(t.viewport),this.emit("graph:deserialize",t)}destroy(){var t,e,s,i;this.clear(),(t=this.grid)==null||t.destroy(),(e=this.contextMenu)==null||e.destroy(),(s=this.viewportElement)==null||s.remove(),(i=this.container)==null||i.classList.remove("ng-container"),this.emit("graph:destroy")}}p.ClipboardManager=P,p.Connection=b,p.ContextMenuManager=I,p.EventEmitter=m,p.GridManager=N,p.Group=w,p.Node=S,p.NodeGraph=A,p.SelectionManager=L,p.Slot=v,p.SlotOrientation=f,p.SlotShape=E,p.ViewportManager=C,p.calculateBezierPath=x,p.debounce=M,p.getBezierMidpoint=z,p.throttle=_,p.uid=g,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})}));
